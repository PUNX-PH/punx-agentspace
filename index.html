<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>D‑ID Agent Live Chat</title>
  <script type="module">
    import * as sdk from 'https://cdn.jsdelivr.net/npm/@d-id/client-sdk/+esm';

    const agentId = 'agt_Jd4BnTW4';
    const auth = { type: 'key', clientKey: 'ZXZhbmRlci5mb3h4QGRzaXRpcC5jb20:rAPO4vw9SfmtqivYRHhf4' };

    const callbacks = {
      onSrcObjectReady(value) {
        video.srcObject = value;
      },
      onVideoStateChange(state) {
        status.textContent = `Video state: ${state}`;
      },
      onError(err) {
        console.error('Agent SDK error:', err);
        status.textContent = `Error: ${err.message}`;
      }
    };

    const streamOptions = { compatibilityMode: 'auto', streamWarmup: true };

    let agentManager;

    async function initAgent() {
      agentManager = await sdk.createAgentManager(agentId, {
        auth,
        callbacks,
        streamOptions
      });
      await agentManager.connect();
      status.textContent = 'Connected — ready to chat';
    }

    async function sendMessage() {
      const text = input.value.trim();
      if (!text) return;
      status.textContent = 'Sending…';
      await agentManager.chat(text);
      status.textContent = 'Awaiting response…';
    }

    window.addEventListener('DOMContentLoaded', () => {
      initAgent();

      document.getElementById('sendBtn').onclick = sendMessage;
    });
  </script>
</head>
<body>
  <h1>Interactive D‑ID Agent</h1>
  <video id="video" autoplay playsinline width="480" height="360"></video>
  <div id="status">Initializing...</div>
  <input id="input" type="text" placeholder="Say something to the agent" size="50"/>
  <button id="sendBtn">Send</button>
</body>
</html>
